/*eslint-disable */
const cards = {
  '2,heart': {
    'value': 2,
    'lowCount': 1,
    'highCount': 1,
    'type': '2',
    'suit': 'heart',
    'html': '&#127154',
    'key': '2,heart'
  },
  '2,diamond': {
    'value': 2,
    'lowCount': 1,
    'highCount': 1,
    'type': '2',
    'suit': 'diamond',
    'html': '&#127170',
    'key': '2,diamond'
  },
  '2,spade': {
    'value': 2,
    'lowCount': 1,
    'highCount': 1,
    'type': '2',
    'suit': 'spade',
    'html': '&#127138',
    'key': '2,spade'
  },
  '2,club': {
    'value': 2,
    'lowCount': 1,
    'highCount': 1,
    'type': '2',
    'suit': 'club',
    'html': '&#127186',
    'key': '2,club'
  },
  '3,heart': {
    'value': 3,
    'lowCount': 1,
    'highCount': 2,
    'type': '3',
    'suit': 'heart',
    'html': '&#127155',
    'key': '3,heart'
  },
  '3,diamond': {
    'value': 3,
    'lowCount': 1,
    'highCount': 2,
    'type': '3',
    'suit': 'diamond',
    'html': '&#127171',
    'key': '3,diamond'
  },
  '3,spade': {
    'value': 3,
    'lowCount': 1,
    'highCount': 2,
    'type': '3',
    'suit': 'spade',
    'html': '&#127139',
    'key': '3,spade'
  },
  '3,club': {
    'value': 3,
    'lowCount': 1,
    'highCount': 2,
    'type': '3',
    'suit': 'club',
    'html': '&#127187',
    'key': '3,club'
  },
  '4,heart': {
    'value': 4,
    'lowCount': 1,
    'highCount': 2,
    'type': '4',
    'suit': 'heart',
    'html': '&#127156',
    'key': '4,heart'
  },
  '4,diamond': {
    'value': 4,
    'lowCount': 1,
    'highCount': 2,
    'type': '4',
    'suit': 'diamond',
    'html': '&#127172',
    'key': '4,diamond'
  },
  '4,spade': {
    'value': 4,
    'lowCount': 1,
    'highCount': 2,
    'type': '4',
    'suit': 'spade',
    'html': '&#127140',
    'key': '4,spade'
  },
  '4,club': {
    'value': 4,
    'lowCount': 1,
    'highCount': 2,
    'type': '4',
    'suit': 'club',
    'html': '&#127188',
    'key': '4,club'
  },
  '5,heart': {
    'value': 5,
    'lowCount': 1,
    'highCount': 3,
    'type': '5',
    'suit': 'heart',
    'html': '&#127157',
    'key': '5,heart'
  },
  '5,diamond': {
    'value': 5,
    'lowCount': 1,
    'highCount': 3,
    'type': '5',
    'suit': 'diamond',
    'html': '&#127173',
    'key': '5,diamond'
  },
  '5,spade': {
    'value': 5,
    'lowCount': 1,
    'highCount': 3,
    'type': '5',
    'suit': 'spade',
    'html': '&#127141',
    'key': '5,spade'
  },
  '5,club': {
    'value': 5,
    'lowCount': 1,
    'highCount': 3,
    'type': '5',
    'suit': 'club',
    'html': '&#127189',
    'key': '5,club'
  },
  '6,heart': {
    'value': 6,
    'lowCount': 1,
    'highCount': 2,
    'type': '6',
    'suit': 'heart',
    'html': '&#127158',
    'key': '6,heart'
  },
  '6,diamond': {
    'value': 6,
    'lowCount': 1,
    'highCount': 2,
    'type': '6',
    'suit': 'diamond',
    'html': '&#127174',
    'key': '6,diamond'
  },
  '6,spade': {
    'value': 6,
    'lowCount': 1,
    'highCount': 2,
    'type': '6',
    'suit': 'spade',
    'html': '&#127142',
    'key': '6,spade'
  },
  '6,club': {
    'value': 6,
    'lowCount': 1,
    'highCount': 2,
    'type': '6',
    'suit': 'club',
    'html': '&#127190',
    'key': '6,club'
  },
  '7,heart': {
    'value': 7,
    'lowCount': 0,
    'highCount': 2,
    'type': '7',
    'suit': 'heart',
    'html': '&#127159',
    'key': '7,heart'
  },
  '7,diamond': {
    'value': 7,
    'lowCount': 0,
    'highCount': 2,
    'type': '7',
    'suit': 'diamond',
    'html': '&#127175',
    'key': '7,diamond'
  },
  '7,spade': {
    'value': 7,
    'lowCount': 0,
    'highCount': 2,
    'type': '7',
    'suit': 'spade',
    'html': '&#127143',
    'key': '7,spade'
  },
  '7,club': {
    'value': 7,
    'lowCount': 0,
    'highCount': 2,
    'type': '7',
    'suit': 'club',
    'html': '&#127191',
    'key': '7,club'
  },
  '8,heart': {
    'value': 8,
    'lowCount': 0,
    'highCount': 1,
    'type': '8',
    'suit': 'heart',
    'html': '&#127160',
    'key': '8,heart'
  },
  '8,diamond': {
    'value': 8,
    'lowCount': 0,
    'highCount': 1,
    'type': '8',
    'suit': 'diamond',
    'html': '&#127176',
    'key': '8,diamond'
  },
  '8,spade': {
    'value': 8,
    'lowCount': 0,
    'highCount': 1,
    'type': '8',
    'suit': 'spade',
    'html': '&#127144',
    'key': '8,spade'
  },
  '8,club': {
    'value': 8,
    'lowCount': 0,
    'highCount': 1,
    'type': '8',
    'suit': 'club',
    'html': '&#127192',
    'key': '8,club'
  },
  '9,heart': {
    'value': 9,
    'lowCount': 0,
    'highCount': -1,
    'type': '9',
    'suit': 'heart',
    'html': '&#127161',
    'key': '9,heart'
  },
  '9,diamond': {
    'value': 9,
    'lowCount': 0,
    'highCount': -1,
    'type': '9',
    'suit': 'diamond',
    'html': '&#127177',
    'key': '9,diamond'
  },
  '9,spade': {
    'value': 9,
    'lowCount': 0,
    'highCount': -1,
    'type': '9',
    'suit': 'spade',
    'html': '&#127145',
    'key': '9,spade'
  },
  '9,club': {
    'value': 9,
    'lowCount': 0,
    'highCount': -1,
    'type': '9',
    'suit': 'club',
    'html': '&#127193',
    'key': '9,club'
  },
  '10,heart': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': '10',
    'suit': 'heart',
    'html': '&#127162',
    'key': '10,heart'
  },
  '10,diamond': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': '10',
    'suit': 'diamond',
    'html': '&#127178',
    'key': '10,diamond'
  },
  '10,spade': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': '10',
    'suit': 'spade',
    'html': '&#127146',
    'key': '10,spade'
  },
  '10,club': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': '10',
    'suit': 'club',
    'html': '&#127194',
    'key': '10,club'
  },
  'j,heart': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'j',
    'suit': 'heart',
    'html': '&#127163',
    'key': 'j,heart'
  },
  'j,diamond': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'j',
    'suit': 'diamond',
    'html': '&#127179',
    'key': 'j,diamond'
  },
  'j,spade': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'j',
    'suit': 'spade',
    'html': '&#127147',
    'key': 'j,spade'
  },
  'j,club': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'j',
    'suit': 'club',
    'html': '&#127195',
    'key': 'j,club'
  },
  'q,heart': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'q',
    'suit': 'heart',
    'html': '&#127165',
    'key': 'q,heart'
  },
  'q,diamond': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'q',
    'suit': 'diamond',
    'html': '&#127181',
    'key': 'q,diamond'
  },
  'q,spade': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'q',
    'suit': 'spade',
    'html': '&#127149',
    'key': 'q,spade'
  },
  'q,club': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'q',
    'suit': 'club',
    'html': '&#127197',
    'key': 'q,club'
  },
  'k,heart': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'k',
    'suit': 'heart',
    'html': '&#127166',
    'key': 'k,heart'
  },
  'k,diamond': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'k',
    'suit': 'diamond',
    'html': '&#127182',
    'key': 'k,diamond'
  },
  'k,spade': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'k',
    'suit': 'spade',
    'html': '&#127150',
    'key': 'k,spade'
  },
  'k,club': {
    'value': 10,
    'lowCount': -1,
    'highCount': -3,
    'type': 'k',
    'suit': 'club',
    'html': '&#127198',
    'key': 'k,club'
  },
  'a,heart': {
    'value': 1,
    'highValue': 11,
    'lowCount': -1,
    'highCount': -3,
    'type': 'a',
    'suit': 'heart',
    'html': '&#127153',
    'key': 'a,heart'
  },
  'a,diamond': {
    'value': 1,
    'highValue': 11,
    'lowCount': -1,
    'highCount': -3,
    'type': 'a',
    'suit': 'diamond',
    'html': '&#127169',
    'key': 'a,diamond'
  },
  'a,spade': {
    'value': 1,
    'highValue': 11,
    'lowCount': -1,
    'highCount': -3,
    'type': 'a',
    'suit': 'spade',
    'html': '&#127137',
    'key': 'a,spade'
  },
  'a,club': {
    'value': 1,
    'highValue': 11,
    'lowCount': -1,
    'highCount': -3,
    'type': 'a',
    'suit': 'club',
    'html': '&#127185',
    'key': 'a,club'
  },
};
/*eslint-enable */

const getDeck = () => Object.keys(cards).map(key => cards[key]);

const getShoe = intOfDecks => {
  let shoe = [];

  if (!intOfDecks || typeof intOfDecks !== 'number') {
    return getDeck();
  }

  for (let i = 0; i < intOfDecks; i++) {
    const newDeck = getDeck();
    shoe = [...shoe, ...newDeck];
  }

  return shoe;
};
// https://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array
const shuffle = a => {
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
};
const multiShuffle = (shoe, intToShuffle) => {
  let emptyShoe;
  for (let i = 0; i < intToShuffle; i++) {
    emptyShoe = shuffle(shoe);
  }
  return emptyShoe;
};

function makeShoe(decks = 8, context) {
  const intToShuffle = 4;
  const shoe = multiShuffle(getShoe(decks), intToShuffle);
  // const shoe = [cards['2,heart'], cards['2,diamond'], cards['a,diamond'], cards['j,diamond']];
  shoe.isDoubles = context.settings.wtc.doubles;
  shoe.startTotal = shoe.length;
  shoe.getCardsRemaining = () => shoe.length;
  shoe.getNextCards = () => {
    const drawTwo = () => {
      const firstCard = shoe.shift();
      const secondCard = shoe.shift();
      return firstCard && secondCard ? [firstCard, secondCard] : [];
    };
    const drawOne = () => {
      const card = shoe.shift();
      return card ? [card] : [];
    };
    return shoe.isDoubles ? drawTwo() : drawOne();
  };
  shoe.getTheCount = (hand, currentCount) => {
    if (!hand.length) {
      return currentCount;
    }

    if (shoe.isDoubles) {
      return hand[0].highCount + hand[1].highCount + currentCount;
    }
    return hand[0].highCount + currentCount;
  };
  shoe.getTrueCount = count => {
    const remainingDecks = shoe.length / 52;
    const roundUpToNearestHalf = num => Math.round(num * 2) / 2;
    return count / roundUpToNearestHalf(remainingDecks);
  };
  return shoe;
}

export default makeShoe;
